# Testing Camera on Phone via Local Network

This guide explains how to test the barcode scanner camera feature from your phone while developing locally.

## Why HTTPS is Required

Modern browsers (including mobile browsers) require HTTPS to access the camera API, except when accessing from `localhost`. When you access your dev server from your phone using your computer's local IP address (e.g., `192.168.1.100:5173`), the browser treats it as a remote connection and requires HTTPS.

## Quick Start

1. **Generate SSL certificates** (one-time setup):
   ```bash
   make dev-certs
   ```

2. **Start the dev server with HTTPS**:
   ```bash
   make dev-https
   ```

3. **Find your computer's local IP address**:
   ```bash
   # macOS
   ifconfig | grep 'inet ' | grep -v 127.0.0.1

   # Linux
   ip addr show | grep 'inet ' | grep -v 127.0.0.1

   # Or use this command (works on both)
   ipconfig getifaddr en0 || ipconfig getifaddr en1
   ```

4. **On your phone**:
   - Connect to the same Wi-Fi network as your computer
   - Open your browser and navigate to: `https://YOUR_LOCAL_IP:5173`
   - Example: `https://192.168.1.100:5173`

5. **Accept the security warning**:
   - Your phone will show a security warning because the certificate is self-signed
   - This is safe for development - click "Advanced" → "Proceed anyway" (or similar)
   - The exact wording varies by browser

6. **Grant camera permissions**:
   - When you open the barcode scanner, your phone will prompt for camera permission
   - Grant permission to test the camera feature

## Backend CORS Configuration

The backend needs to allow requests from your phone's origin. By default, it allows `http://localhost:5173`. When using HTTPS from your phone, you need to add your phone's origin.

### Option 1: Environment Variable (Recommended)

Set the `ALLOW_ORIGINS` environment variable to include your phone's origin:

```bash
# Start backend with allowed origins
ALLOW_ORIGINS="http://localhost:5173,https://192.168.1.100:5173" make dev-backend
```

Or for the full HTTPS dev setup:

```bash
# In one terminal
ALLOW_ORIGINS="http://localhost:5173,https://YOUR_LOCAL_IP:5173" cd backend && go run ./cmd/server

# In another terminal
cd frontend && VITE_HTTPS=true npm run dev
```

### Option 2: Update Default in main.go

You can modify the default in `backend/cmd/server/main.go`:

```go
allowOrigins := strings.Split(getEnv("ALLOW_ORIGINS", "http://localhost:5173,https://localhost:5173"), ",")
```

## Troubleshooting

### Certificate Not Trusted

If your phone shows a security warning:
- This is expected with self-signed certificates
- Click "Advanced" or "Details" → "Proceed" or "Accept Risk"
- The certificate is safe for local development

### Camera Permission Denied

- Make sure you're using HTTPS (not HTTP)
- Check your phone's browser settings for camera permissions
- Try refreshing the page after granting permission

### Can't Connect from Phone

1. **Check firewall**: Make sure your computer's firewall allows connections on port 5173
2. **Check network**: Ensure phone and computer are on the same Wi-Fi network
3. **Check IP address**: Verify you're using the correct local IP address
4. **Check Vite is listening**: The dev server should show "Local: https://0.0.0.0:5173"

### CORS Errors

If you see CORS errors in the browser console:
- Make sure `ALLOW_ORIGINS` includes your phone's origin (with `https://` and the correct port)
- Restart the backend server after changing `ALLOW_ORIGINS`

### Certificate Expired

Certificates are valid for 365 days. To regenerate:

```bash
rm -rf .dev-certs
make dev-certs
```

## Alternative: Using ngrok (for external testing)

If you need to test from outside your local network, you can use ngrok:

```bash
# Install ngrok: https://ngrok.com/download
# Start your dev server normally
make dev

# In another terminal, create HTTPS tunnel
ngrok http 5173
```

Then use the ngrok HTTPS URL on your phone. Note: ngrok free tier has limitations.

## Security Note

⚠️ **Important**: The self-signed certificates generated by `make dev-certs` are for **development only**. Never use them in production. They are not trusted by browsers and will show security warnings, which is expected and safe for local development.

